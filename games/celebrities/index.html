<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Clone</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
<style>
    body {
        margin: 0;
        padding: 0;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
        overflow: hidden;
    }
    #game-container {
        border: 2px solid #333;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        position: relative;
    }
    #ui {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 24px;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        z-index: 10;
    }
    #start-screen, #game-over-screen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255,255,255,0.9);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        z-index: 20;
    }
    button {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
    }
    button:hover {
        background: #45a049;
    }
    .hidden { display: none; }
</style>
</head>
<body>
<div id="game-container"></div>
<div id="ui">
    <div>Score: <span id="score">0</span></div>
</div>
<div id="start-screen">
    <h1>Flappy Bird</h1>
    <p>Press SPACE or CLICK to start!</p>
    <button id="start-btn">Start Game</button>
</div>
<div id="game-over-screen" class="hidden">
    <h2>Game Over!</h2>
    <p>Score: <span id="final-score">0</span></p>
    <p>High Score: <span id="high-score">0</span></p>
    <button id="restart-btn">Play Again</button>
    <button id="menu-btn">Main Menu</button>
</div>

<script>
let game;
let score = 0;
let highScore = localStorage.getItem('flappyHighScore') || 0;
document.getElementById('high-score').textContent = highScore;

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    parent: 'game-container',
    physics: { default: 'arcade', arcade: { gravity: { y: 600 }, debug: false }},
    scene: { preload, create, update }
};

let bird, pipes, cursors, scoreText, gameStarted = false, gameOver = false, pipeTimer;
let bg, ground;

function preload() {
    // Bird texture
    const birdGraphics = this.add.graphics();
    birdGraphics.fillStyle(0xffff00);
    birdGraphics.fillCircle(12,12,12);
    birdGraphics.fillStyle(0xff0000);
    birdGraphics.fillTriangle(20,12,28,16,20,20);
    birdGraphics.fillStyle(0x000000);
    birdGraphics.fillCircle(16,8,2);
    birdGraphics.generateTexture('bird',24,24);
    birdGraphics.destroy();

    // Pipe texture
    const pipeGraphics = this.add.graphics();
    pipeGraphics.fillStyle(0x228B22);
    pipeGraphics.fillRect(0,0,52,320);
    pipeGraphics.lineStyle(2,0x006400);
    pipeGraphics.strokeRect(0,0,52,320);
    pipeGraphics.fillStyle(0x32CD32);
    pipeGraphics.fillRect(-10,0,72,20);
    pipeGraphics.generateTexture('pipe',52,340);
    pipeGraphics.destroy();

    // Background
    const bgGraphics = this.make.graphics({ add:false });
    bgGraphics.fillGradientStyle(0x87CEEB,0x87CEEB,0x98FB98,0x98FB98,1);
    bgGraphics.fillRect(0,0,800,600);
    bgGraphics.generateTexture("bgTex",800,600);
    bgGraphics.destroy();

    // Ground tile (grass)
    const groundGraphics = this.make.graphics({ add:false });
    groundGraphics.fillStyle(0x228B22);
    groundGraphics.fillRect(0,0,40,40);
    groundGraphics.fillStyle(0x8B4513);
    groundGraphics.fillRect(0,30,40,10);
    groundGraphics.generateTexture("groundTile",40,40);
    groundGraphics.destroy();
}

function create() {
    // Background
    bg = this.add.tileSprite(400,300,800,600,"bgTex");
    ground = this.add.tileSprite(400,580,800,40,"groundTile");
    this.physics.add.existing(ground,true);

    // Bird
    bird = this.physics.add.sprite(100,300,'bird');
    bird.setCollideWorldBounds(false);
    bird.setOrigin(0.5,0.5);

    // Pipes
    pipes = this.physics.add.group();

    // Input
    cursors = this.input.keyboard.createCursorKeys();
    this.input.on('pointerdown', flap);
    this.input.keyboard.on('keydown-SPACE', flap);

    // Score
    scoreText = this.add.text(350,50,'Score: 0',{ fontSize:'32px', fill:'#000' });

    // Timer for pipes
    pipeTimer = this.time.addEvent({ delay:1500, callback:addPipe, callbackScope:this, loop:true });
    pipeTimer.paused = true;

    // Start screen
    showStartScreen();
}

function update() {
    if(!gameStarted || gameOver) return;

    // Bird rotation
    if(bird.body.velocity.y < 0) bird.angle = -25;
    else if(bird.body.velocity.y >= 0) bird.angle = Phaser.Math.Clamp(bird.angle + 2, -25, 90);

    // Scroll background & ground
    bg.tilePositionX += 1;
    ground.tilePositionX += 2;

    // Remove off-screen pipes
    pipes.getChildren().forEach(pipe => { if(pipe.x < -50) pipe.destroy(); });
}

function flap() {
    if(!gameStarted) { startGame(); return; }
    if(gameOver) { restartGame(); return; }
    bird.setVelocityY(-250);
}

function startGame() {
    gameStarted = true;
    gameOver = false;
    score = 0;
    updateScore();
    pipeTimer.paused = false;
    bird.setVelocity(0);
    bird.setPosition(100,300);
    bird.setAngle(0);
    pipes.clear(true,true);
    document.getElementById('start-screen').classList.add('hidden');
}

function addPipe() {
    if(gameOver) return;
    const gapHeight = 180;
    const minGapY = 150;
    const maxGapY = 450;
    const gapY = Phaser.Math.Between(minGapY,maxGapY);
    const topY = gapY - gapHeight/2;
    const bottomY = gapY + gapHeight/2;

    const topPipe = this.physics.add.sprite(800,topY,'pipe');
    topPipe.setOrigin(0.5,1).setFlipY(true).setImmovable(true);
    topPipe.body.allowGravity = false;
    topPipe.body.velocity.x = -200;
    pipes.add(topPipe);

    const bottomPipe = this.physics.add.sprite(800,bottomY,'pipe');
    bottomPipe.setOrigin(0.5,0).setImmovable(true);
    bottomPipe.body.allowGravity = false;
    bottomPipe.body.velocity.x = -200;
    pipes.add(bottomPipe);

    const scoreZone = this.add.zone(800-26,gapY,52,gapHeight);
    this.physics.add.existing(scoreZone);
    scoreZone.body.allowGravity = false;
    scoreZone.body.velocity.x = -200;
    this.physics.add.overlap(bird, scoreZone, scorePoint, null, this);

    // Collisions
    this.physics.add.collider(bird, pipes, hitPipe, null, this);
    this.physics.add.collider(bird, ground, hitGround, null, this);
}

function scorePoint(bird, zone) {
    if(zone.scored) return;
    zone.scored = true;
    score += 1;
    updateScore();
    zone.destroy();
}

function updateScore() {
    scoreText.setText('Score: '+score);
    document.getElementById('score').textContent = score;
}

function hitPipe(){ endGame(); }
function hitGround(){ endGame(); }

function endGame() {
    gameOver = true;
    pipeTimer.paused = true;
    bird.setTint(0xff0000);
    if(score > highScore){
        highScore = score;
        localStorage.setItem('flappyHighScore',highScore);
        document.getElementById('high-score').textContent = highScore;
    }
    document.getElementById('final-score').textContent = score;
    showGameOverScreen();
}

function restartGame() {
    startGame();
    document.getElementById('game-over-screen').classList.add('hidden');
}

function showStartScreen() {
    document.getElementById('start-screen').classList.remove('hidden');
    document.getElementById('start-btn').onclick = () => flap();
}

function showGameOverScreen() {
    document.getElementById('game-over-screen').classList.remove('hidden');
    document.getElementById('restart-btn').onclick = () => flap();
    document.getElementById('menu-btn').onclick = () => {
        document.getElementById('game-over-screen').classList.add('hidden');
        showStartScreen();
        gameOver = false;
        score = 0;
        updateScore();
    };
}

game = new Phaser.Game(config);
</script>
</body>
</html>
